---
title: JVMä¼˜åŒ–ï¼šjvmå‚æ•°ã€gcæ—¥å¿—ç»éªŒåˆ†äº«
date: 2019-07-16 21:32:12
type: "tags"
tags: [jvm]
---

> ä»è¿™ç¯‡å¼€å§‹å†™ä¸€äº›jvmè°ƒä¼˜ç›¸å…³çš„å†…å®¹ï¼Œä¸€èµ·æ¥æ­å¼€jvmç¥ç§˜çš„é¢çº±å§~  ğŸ¥•

<!--more-->

ä¹‹å‰çš„æ–‡ç« [æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº--è¯»ä¹¦ç¬”è®°](https://7le.top/2018/01/29/æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº--è¯»ä¹¦ç¬”è®°)å·²ç»ä»‹ç»è¿‡jvmï¼ŒåŒ…æ‹¬ä¸€äº›åŸºç¡€çŸ¥è¯†ã€GCçš„ç®—æ³•å’Œåƒåœ¾æ”¶é›†å™¨ä¹‹ç±»ã€‚è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œç›´æ¥è¿›å…¥æ­£é¢˜ã€‚

``æ–‡ç« ä¸­ä¸»è¦æè¿°çš„æ˜¯ParNewå’ŒCMSï¼Œä¸”jdkç‰ˆæœ¬<=1.8ã€‚``

### gcæ—¥å¿—

> ä¿—è¯è¯´å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚è¦åšå¥½Jvmçš„ä¼˜åŒ–ï¼Œé‚£ç†è§£GCæ—¥å¿—å°±æ˜¯åŸºç¡€ã€‚

åœ¨jvmå‚æ•°ä¸Šå¢åŠ è¾“å‡ºæ—¥å¿—çš„å‚æ•°``-XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintHeapAtGC -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -Xloggc:/logs/gc.log``ï¼Œjvmå°±èƒ½ä¸ºæˆ‘ä»¬å°†æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šçš„è·¯å¾„ä¸‹ã€‚

ä¸‹é¢å¼€å§‹åˆ†æParNewå’ŒCMSï¼Œè¯¥æ­é…ä¸»è¦çš„ç›®æ ‡æ˜¯ä½å»¶æ—¶ï¼Œæ¯”è¾ƒå¸¸ç”¨ï¼Œå¦å¤–æˆ‘ä»¬çº¿ä¸Šä¹Ÿæ˜¯é‡‡ç”¨è¿™ä¸ªï¼š
1. æ–°ç”Ÿä»£ï¼šé‡‡ç”¨ stop-the-world mark-copy ç®—æ³•
2. è€å¹´ä»£ï¼šé‡‡ç”¨ Mostly Concurrent mark-sweep ç®—æ³•

èƒ½å¤Ÿè¾¾æˆè¯¥ç›®æ ‡ä¸»è¦å› ä¸ºä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼š
1. å®ƒä¸ä¼šèŠ±æ—¶é—´æ•´ç†å‹ç¼©è€å¹´ä»£ï¼Œè€Œæ˜¯ç»´æŠ¤äº†ä¸€ä¸ªå«åš free-lists çš„æ•°æ®ç»“æ„ï¼Œè¯¥æ•°æ®ç»“æ„ç”¨æ¥ç®¡ç†é‚£äº›å›æ”¶å†åˆ©ç”¨çš„å†…å­˜ç©ºé—´ï¼›
2. CMSåˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼Œåªæœ‰initial markå’Œremarkä¼šè§¦å‘STWï¼Œå…¶ä»–éƒ½æ˜¯ä¸åº”ç”¨çº¿ç¨‹ä¸€åŒè¿è¡Œçš„

#### ParNew/Young GC

```java
{Heap before GC invocations=74 (full 0):
 par new generation   total 341376K, used 294492K [0x0000000083000000, 0x000000009c000000, 0x000000009c000000)
  eden space 273152K, 100% used [0x0000000083000000, 0x0000000093ac0000, 0x0000000093ac0000)
  from space 68224K,  31% used [0x0000000093ac0000, 0x0000000094f970f8, 0x0000000097d60000)
  to   space 68224K,   0% used [0x0000000097d60000, 0x0000000097d60000, 0x000000009c000000)
 concurrent mark-sweep generation total 1638400K, used 96700K [0x000000009c000000, 0x0000000100000000, 0x0000000100000000)
 Metaspace       used 113286K, capacity 119312K, committed 119424K, reserved 1153024K
  class space    used 14248K, capacity 15218K, committed 15232K, reserved 1048576K
2019-07-10T18:26:55.933+0800: 5756.871: [GC (Allocation Failure) 2019-07-10T18:26:55.933+0800: 5756.871: [ParNew
Desired survivor size 34930688 bytes, new threshold 15 (max 15)
- age   1:    1688360 bytes,    1688360 total
- age   2:      51552 bytes,    1739912 total
- age   3:      59880 bytes,    1799792 total
- age   4:      51472 bytes,    1851264 total
- age   5:     100528 bytes,    1951792 total
- age   6:     136576 bytes,    2088368 total
- age   7:      45280 bytes,    2133648 total
- age   8:     251688 bytes,    2385336 total
- age   9:    4738624 bytes,    7123960 total
- age  10:     173024 bytes,    7296984 total
- age  11:      43856 bytes,    7340840 total
- age  12:     297760 bytes,    7638600 total
- age  13:    1440080 bytes,    9078680 total
- age  14:     809944 bytes,    9888624 total
- age  15:    1862752 bytes,   11751376 total
: 294492K->17247K(341376K), 0.0139261 secs] 391192K->114369K(1979776K), 0.0141007 secs] [Times: user=0.05 sys=0.00, real=0.02 secs] 
Heap after GC invocations=75 (full 0):
 par new generation   total 341376K, used 17247K [0x0000000083000000, 0x000000009c000000, 0x000000009c000000)
  eden space 273152K,   0% used [0x0000000083000000, 0x0000000083000000, 0x0000000093ac0000)
  from space 68224K,  25% used [0x0000000097d60000, 0x0000000098e37ed8, 0x000000009c000000)
  to   space 68224K,   0% used [0x0000000093ac0000, 0x0000000093ac0000, 0x0000000097d60000)
 concurrent mark-sweep generation total 1638400K, used 97121K [0x000000009c000000, 0x0000000100000000, 0x0000000100000000)
 Metaspace       used 113286K, capacity 119312K, committed 119424K, reserved 1153024K
  class space    used 14248K, capacity 15218K, committed 15232K, reserved 1048576K
}
```

* Heap before GC  - GCå‰ å †çš„ä¿¡æ¯
   * par new generation total 341376K (eden+s0), used 294492Kï¼ˆå·²è¢«ä½¿ç”¨ï¼‰
   * eden space 273152K, 100% used - edenåŒºæ»¡äº†ï¼Œæ‰€ä»¥è§¦å‘ Young GC
   * from space 68224K,  31% used - å­˜æ”¾å¹´é¾„æœªåˆ°ï¼ˆé»˜è®¤æ˜¯15å²ï¼Œ``-XX:MaxTenuringThreshold``ï¼‰ï¼Œä»å­˜æ´»çš„å¯¹è±¡
   * to   space 68224K,   0% used - å‡†å¤‡åœ¨è¿™æ¬¡YGCå­˜æ”¾from+edenå­˜æ´»ä¸”æœªåˆ°å¹´é¾„çš„å¯¹è±¡
   * concurrent mark-sweep generation total 1638400K, used 96700K - è€å¹´ä»£çš„æ€»é‡å’Œå·²ä½¿ç”¨çš„é‡
   * Metaspace used 113286K, capacity 119312K, committed 119424K, reserved 1153024K - Metaspaceçš„æ€»é‡ï¼Œå·²ä½¿ç”¨ï¼Œæäº¤å’Œä¿ç•™çš„é‡
   * class space used 14248K, capacity 15218K, committed 15232K, reserved 1048576K - ç±»ç©ºé—´çš„æ€»é‡ï¼Œå·²ä½¿ç”¨ï¼Œæäº¤å’Œä¿ç•™çš„é‡
* Young GC
   * 2019-07-10T18:26:55.933+0800 -GCå‘ç”Ÿçš„æ—¶é—´ï¼›
   * 5756.871 â€“ ç›¸å¯¹äºJVMå¯åŠ¨æ—¶çš„é—´éš”æ—¶é—´,å•ä½æ˜¯ç§’ã€‚
   * GC (Allocation Failure) â€“ YGCçš„åŸå› ï¼Œåœ¨è¿™ä¸ªcaseé‡Œè¾¹ï¼Œç”±äºæ–°ç”Ÿä»£ä¸æ»¡è¶³ç”³è¯·çš„ç©ºé—´ï¼Œå› æ­¤è§¦å‘äº†YGC;
   * ParNew â€“ æ”¶é›†å™¨çš„åç§°ï¼Œå®ƒé¢„ç¤ºäº†æ–°ç”Ÿä»£ä½¿ç”¨ä¸€ä¸ªå¹¶è¡Œçš„ mark-copy stop-the-world åƒåœ¾æ”¶é›†å™¨ï¼›
   * new threshold 15 (max 15) - ä»£è¡¨å¹´é¾„çš„é˜€å€¼ä¸º15ï¼Œä¸‹é¢çš„ageæ˜¯å„å¹´é¾„çš„æ•°æ®é‡
   * 294492K->17247K - æ”¶é›†å‰åæ–°ç”Ÿä»£çš„ä½¿ç”¨æƒ…å†µï¼Œ
   * (341376K), 0.0139261 secs - æ•´ä¸ªæ–°ç”Ÿä»£çš„å®¹é‡ï¼Œä»¥åŠåƒåœ¾æ”¶é›†å™¨åœ¨ w/o final cleanup é˜¶æ®µæ¶ˆè€—çš„æ—¶é—´
   * 391192K->114369K â€“  åœ¨åƒåœ¾æ”¶é›†ä¹‹å‰å’Œä¹‹åå †å†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚
   * (1979776K), 0.0141007 secs â€“å¯ç”¨å †çš„æ€»å¤§å°ã€‚ä»¥åŠåƒåœ¾æ”¶é›†å™¨åœ¨æ ‡è®°å’Œå¤åˆ¶æ–°ç”Ÿä»£å­˜æ´»å¯¹è±¡æ—¶æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚åŒ…æ‹¬å’ŒConcurrentMarkSweepæ”¶é›†å™¨çš„é€šä¿¡å¼€é”€, æå‡å­˜æ´»æ—¶é—´è¾¾æ ‡çš„å¯¹è±¡åˆ°è€å¹´ä»£,ä»¥åŠåƒåœ¾æ”¶é›†åæœŸçš„ä¸€äº›æœ€ç»ˆæ¸…ç†ã€‚
   * [Times: user=0.78 sys=0.01, real=0.11 secs] -ä¸Linuxå‘½ä»¤æ‰€è¾“å‡ºçš„æ—¶é—´å«ä¹‰ä¸€è‡´ï¼Œåˆ†åˆ«ä»£è¡¨ç”¨æˆ·æ€æ¶ˆè€—çš„CPUæ—¶é—´ã€å†…æ ¸æ€æ¶ˆè€—çš„CPUæ—¶é—´å’Œæ“ä½œä»å¼€å§‹åˆ°ç»“æŸæ‰€ç»è¿‡çš„å¢™é’Ÿæ—¶é—´ï¼ˆWall Clock Timeï¼‰ã€‚å¢™é’Ÿæ—¶é—´ä¸ CPUæ—¶é—´çš„åŒºåˆ«æ˜¯ï¼Œå¢™é’Ÿæ—¶é—´åŒ…æ‹¬å„ç§éè¿ç®—çš„ç­‰å¾…è€—æ—¶ï¼Œä¾‹å¦‚ç­‰å¾…ç£ç›˜I/Oã€ç­‰å¾…çº¿ç¨‹ç´«å¡ã€‚è€ŒCPUæ—¶é—´ä¸åŒ…æ‹¬è¿™äº›ï¼Œä½†æ˜¯å¤šCPUæˆ–è€…å¤šæ ¸ï¼Œå¤šçº¿ç¨‹æ“ä½œä¼šå åŠ è¿™äº›CPUæ—¶é—´ã€‚
* Heap after GC  - GCå å †çš„ä¿¡æ¯
   * eden space 273152K,   0% used - Young GCå edenåŒºæ¸…ç©ºäº†
   * from space 68224K,  25% used - ``å¯¹åº”çš„æ˜¯Heap beforeä¸­çš„to``
   * to   space 68224K,   0% used - ``å¯¹åº”çš„æ˜¯Heap beforeä¸­çš„from``

ä»ä»¥ä¸Šçš„ä¿¡æ¯æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºåœ¨åƒåœ¾æ”¶é›†æœŸé—´, JVMä¸­çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚åœ¨GCä¹‹å‰æ€»çš„å †å†…å­˜ä½¿ç”¨é‡ä¸º **391192K** æ–°ç”Ÿä»£çš„ä½¿ç”¨é‡ä¸º**294492K**ã€‚è¿™æ„å‘³ç€è€å¹´ä»£ä½¿ç”¨é‡ç­‰äº**95M(382-287)** ã€‚GCä¹‹å,æ–°ç”Ÿä»£çš„ä½¿ç”¨é‡å‡å°‘äº†**277245K(294492K-17247K)**, è€Œæ€»çš„å †å†…å­˜ä½¿ç”¨ä¸‹é™äº†**276823K(391192K-114369K)**ã€‚å¯ä»¥ç®—å‡ºæœ‰ **422K(277245K-276823K)** çš„å¯¹è±¡ä»æ–°ç”Ÿä»£æå‡åˆ°è€å¹´ä»£ã€‚å› ä¸ºè¿™ä¸ªå–çš„æ˜¯æœåŠ¡åˆšå¯åŠ¨ä¸å°±çš„gcæ—¥å¿—ï¼Œæ‰€ä»¥åˆ°è€å¹´ä»£çš„å¯¹è±¡å¹¶ä¸å¤šã€‚


#### CMS/Old GC

```java
2019-07-11T16:30:06.802+0800: 10.105: [GC (CMS Initial Mark) [1 CMS-initial-mark: 1536000K(1638400K)] 1557852K(1979776K), 0.0164961 secs] [Times: user=0.02 sys=0.00, real=0.02 secs] 
2019-07-11T16:30:06.819+0800: 10.122: [CMS-concurrent-mark-start]
2019-07-11T16:30:06.845+0800: 10.148: [CMS-concurrent-mark: 0.026/0.026 secs] [Times: user=0.02 sys=0.01, real=0.03 secs] 
2019-07-11T16:30:06.846+0800: 10.148: [CMS-concurrent-preclean-start]
2019-07-11T16:30:06.852+0800: 10.155: [CMS-concurrent-preclean: 0.007/0.007 secs] [Times: user=0.01 sys=0.00, real=0.00 secs] 
2019-07-11T16:30:06.852+0800: 10.155: [CMS-concurrent-abortable-preclean-start]
 CMS: abort preclean due to time 2019-07-11T16:30:11.947+0800: 15.249: [CMS-concurrent-abortable-preclean: 0.374/5.094 secs] [Times: user=0.36 sys=0.02, real=5.10 secs] 
2019-07-11T16:30:11.948+0800: 15.250: [GC (CMS Final Remark) [YG occupancy: 21852 K (341376 K)]2019-07-11T16:30:11.948+0800: 15.250: [Rescan (parallel) , 0.0179172 secs]2019-07-11T16:30:11.966+0800: 15.268: [weak refs processing, 0.0000590 secs]2019-07-11T16:30:11.966+0800: 15.268: [class unloading, 0.0016677 secs]2019-07-11T16:30:11.968+0800: 15.270: [scrub symbol table, 0.0009642 secs]2019-07-11T16:30:11.969+0800: 15.271: [scrub string table, 0.0004421 secs][1 CMS-remark: 1536000K(1638400K)] 1557852K(1979776K), 0.0215229 secs] [Times: user=0.06 sys=0.00, real=0.02 secs] 
2019-07-11T16:30:11.970+0800: 15.273: [CMS-concurrent-sweep-start]
2019-07-11T16:30:11.971+0800: 15.273: [CMS-concurrent-sweep: 0.007/0.007 secs] [Times: user=0.02 sys=0.00, real=0.02 secs] 
2019-07-11T16:30:11.971+0800: 15.273: [CMS-concurrent-reset-start]
2019-07-11T16:30:11.977+0800: 15.279: [CMS-concurrent-reset: 0.006/0.006 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] 
```

* CMS Initial Mark - åˆå§‹æ ‡è®°ï¼ˆä¼šå‡ºç°STWï¼‰ï¼Œä¸»è¦æ ‡è®°æ‰€æœ‰çš„GC Rootï¼Œåœ¨jdk<1.8çš„æ—¶å€™å¯ä»¥è®¾ç½®``-XX:+CMSParallelInitialMarkEnabled``æ¥è¿›è¡Œå¹¶è¡Œã€‚
   * 1536000K â€“ è€å¹´ä»£çš„å½“å‰ä½¿ç”¨é‡ã€‚
   * (1638400K) â€“ è€å¹´ä»£ä¸­å¯ç”¨å†…å­˜æ€»é‡ã€‚
   * 1557852K â€“  å½“å‰å †å†…å­˜çš„ä½¿ç”¨é‡ã€‚
   * (1979776K) â€“ å¯ç”¨å †çš„æ€»å¤§å°ã€‚
   * 0.0164961 secs] [Times: user=0.02 sys=0.00, real=0.02 secs] â€“ æ­¤æ¬¡æš‚åœçš„æŒç»­æ—¶é—´, ä»¥ user, system å’Œ real time 3ä¸ªéƒ¨åˆ†è¿›è¡Œè¡¡é‡
* CMS Concurrent Mark - å¹¶å‘é¢„æ¸…ç†ï¼ˆä¸åº”ç”¨çº¿ç¨‹ä¸€èµ·è¿è¡Œï¼‰ï¼Œåœ¨æ­¤é˜¶æ®µ, åƒåœ¾æ”¶é›†å™¨éå†è€å¹´ä»£ï¼Œæ ‡è®°æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡ã€‚
   * 0.026/0.026 secs - æ­¤é˜¶æ®µçš„æŒç»­æ—¶é—´, åˆ†åˆ«æ˜¯è¿è¡Œæ—¶é—´å’Œç›¸åº”çš„å®é™…æ—¶é—´ã€‚
   * [Times: user=0.02 sys=0.01, real=0.03 secs] - è¿™éƒ¨åˆ†å¯¹å¹¶å‘é˜¶æ®µæ¥è¯´æ²¡å¤šå°‘æ„ä¹‰, å› ä¸ºæ˜¯ä»å¹¶å‘æ ‡è®°å¼€å§‹æ—¶è®¡ç®—çš„,è€Œè¿™æ®µæ—¶é—´å†…ä¸ä»…å¹¶å‘æ ‡è®°åœ¨è¿è¡Œ,ç¨‹åºä¹Ÿåœ¨è¿è¡Œã€‚
* CMS Concurrent Preclean - å¹¶å‘é¢„æ¸…ç† ï¼ˆä¸åº”ç”¨çº¿ç¨‹ä¸€èµ·è¿è¡Œï¼‰ï¼Œå› ä¸ºå‰ä¸€é˜¶æ®µæ˜¯ä¸ç¨‹åºå¹¶å‘è¿›è¡Œçš„,å¯èƒ½æœ‰ä¸€äº›å¼•ç”¨å·²ç»æ”¹å˜ã€‚å¦‚æœåœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼•ç”¨å…³ç³»å˜åŒ–,JVMä¼šï¼ˆé€šè¿‡Cardï¼‰å°†å‘ç”Ÿäº†æ”¹å˜çš„åŒºåŸŸæ ‡è®°ä¸º**è„**åŒºã€‚
   * 0.007/0.007 secs æ­¤é˜¶æ®µçš„æŒç»­æ—¶é—´, åˆ†åˆ«æ˜¯è¿è¡Œæ—¶é—´å’Œå¯¹åº”çš„å®é™…æ—¶é—´
   * [Times: user=0.02 sys=0.00, real=0.02 secs] - åŒæ ·æ˜¯ä¸åº”ç”¨çº¿ç¨‹ä¸€èµ·è¿è¡Œï¼Œè¿™ä¸ªæ—¶é—´æ²¡ä»€ä¹ˆæ„ä¹‰
* CMS Concurrent Abortable Preclean - å¹¶å‘å¯å–æ¶ˆçš„é¢„æ¸…ç†ï¼ˆä¸åº”ç”¨çº¿ç¨‹ä¸€èµ·è¿è¡Œï¼‰ï¼Œæœ¬é˜¶æ®µå°è¯•åœ¨ STW çš„ Final Remark ä¹‹å‰å°½å¯èƒ½åœ°å¤šåšä¸€äº›å·¥ä½œã€‚
   * 0.374/5.094 secs - åŒæ ·æ˜¯è¿è¡Œæ—¶é—´å’Œç›¸åº”çš„å®é™…æ—¶é—´ï¼Œä¸åŒçš„æ˜¯è¿™é‡Œå·®è·æ¯”ä¹‹å‰å¤§å¾ˆå¤šã€‚å› ä¸ºè¿™é‡Œåªè¿›è¡Œäº†å°‘é‡çš„å·¥ä½œ â€” 0.374ç§’çš„CPUæ—¶é—´ï¼ŒGCçº¿ç¨‹ç»å†äº†å¾ˆå¤šç­‰å¾…æ—¶é—´ã€‚
   * [Times: user=0.36 sys=0.02, real=5.10 secs] - åŒæ ·æ˜¯ä¸åº”ç”¨çº¿ç¨‹ä¸€èµ·è¿è¡Œï¼Œè¿™ä¸ªæ—¶é—´æ²¡ä»€ä¹ˆæ„ä¹‰ã€‚
* Final Remark - æœ€ç»ˆæ ‡è®°ï¼Œè¿™æ˜¯æ­¤æ¬¡GCäº‹ä»¶ä¸­ç¬¬äºŒæ¬¡(ä¹Ÿæ˜¯æœ€åä¸€æ¬¡)STWé˜¶æ®µã€‚æœ¬é˜¶æ®µçš„ç›®æ ‡æ˜¯å®Œæˆè€å¹´ä»£ä¸­æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„æ ‡è®°. å› ä¸ºä¹‹å‰çš„ preclean é˜¶æ®µæ˜¯å¹¶å‘çš„, æœ‰å¯èƒ½æ— æ³•è·Ÿä¸Šåº”ç”¨ç¨‹åºçš„å˜åŒ–é€Ÿåº¦ã€‚æ‰€ä»¥éœ€è¦ STWæš‚åœæ¥å¤„ç†å¤æ‚æƒ…å†µã€‚
   * YG occupancy: 21852 K (341376 K) - å½“å‰æ–°ç”Ÿä»£çš„ä½¿ç”¨é‡å’Œæ€»å®¹é‡ã€‚
   * [Rescan (parallel) , 0.0179172 secs] - åœ¨ç¨‹åºæš‚åœæ—¶é‡æ–°è¿›è¡Œæ‰«æ(Rescan),ä»¥å®Œæˆå­˜æ´»å¯¹è±¡çš„æ ‡è®°ã€‚æ­¤æ—¶ rescan æ˜¯å¹¶è¡Œæ‰§è¡Œçš„,æ¶ˆè€—çš„æ—¶é—´ä¸º 0179172ç§’ã€‚
   * weak refs processing, 0.0000590 secs  -  å¤„ç†å¼±å¼•ç”¨çš„ç¬¬ä¸€ä¸ªå­é˜¶æ®µ(sub-phases)çš„æ˜¯æŒç»­æ—¶é—´ã€‚
   * class unloading, 0.0016677 secs - ç¬¬äºŒä¸ªå­é˜¶æ®µ, å¸è½½ä¸ä½¿ç”¨çš„ç±»çš„æ˜¯æŒç»­æ—¶é—´ã€‚
   * scrub string table, 0.0004421 secs - æœ€åä¸€ä¸ªå­é˜¶æ®µ, æ¸…ç†æŒæœ‰classçº§åˆ« metadata çš„ç¬¦å·è¡¨(symbol tables),ä»¥åŠå†…éƒ¨åŒ–å­—ç¬¦ä¸²å¯¹åº”çš„ string tablesã€‚å½“ç„¶ä¹Ÿæ˜¾ç¤ºäº†æš‚åœçš„æ—¶é’Ÿæ—¶é—´ã€‚
   * 1536000K(1638400K) - æ­¤é˜¶æ®µå®Œæˆåè€å¹´ä»£çš„ä½¿ç”¨é‡å’Œæ€»å®¹é‡ã€‚
   * 1557852K(1979776K) - æ­¤é˜¶æ®µå®Œæˆåæ•´ä¸ªå †å†…å­˜çš„ä½¿ç”¨é‡å’Œæ€»å®¹é‡ã€‚
   * 0.0215229 secs - æ­¤é˜¶æ®µçš„æŒç»­æ—¶é—´ã€‚
   * [Times: user=0.06 sys=0.00, real=0.02 secs]  - GCäº‹ä»¶çš„æŒç»­æ—¶é—´, é€šè¿‡ä¸åŒçš„ç±»åˆ«æ¥è¡¡é‡: user, system and real timeã€‚
* Concurrent Sweep - å¹¶å‘æ¸…é™¤ï¼ˆä¸åº”ç”¨çº¿ç¨‹ä¸€èµ·è¿è¡Œï¼‰ï¼Œç›®çš„æ˜¯åˆ é™¤æœªä½¿ç”¨çš„å¯¹è±¡ï¼Œå¹¶æ”¶å›ä»–ä»¬å ç”¨çš„ç©ºé—´ã€‚
   * 0.007/0.007 secs - æ­¤é˜¶æ®µçš„æŒç»­æ—¶é—´, åˆ†åˆ«æ˜¯è¿è¡Œæ—¶é—´å’Œå®é™…æ—¶é—´ã€‚
   * [Times: user=0.02 sys=0.00, real=0.02 secs] - åŒæ ·æ˜¯ä¸åº”ç”¨çº¿ç¨‹ä¸€èµ·è¿è¡Œï¼Œè¿™ä¸ªæ—¶é—´æ²¡ä»€ä¹ˆæ„ä¹‰ã€‚
* Concurrent Reset - å¹¶å‘é‡ç½®ï¼ˆä¸åº”ç”¨çº¿ç¨‹ä¸€èµ·è¿è¡Œï¼‰ï¼Œæ­¤é˜¶æ®µä¸åº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œ,é‡ç½®CMSç®—æ³•ç›¸å…³çš„å†…éƒ¨æ•°æ®, ä¸ºä¸‹ä¸€æ¬¡GCå¾ªç¯åšå‡†å¤‡ã€‚
   * 0.006/0.006 secs - æ­¤é˜¶æ®µçš„æŒç»­æ—¶é—´, åˆ†åˆ«æ˜¯è¿è¡Œæ—¶é—´å’Œå®é™…æ—¶é—´ã€‚
   * [Times: user=0.00 sys=0.00, real=0.01 secs] - åŒæ ·æ˜¯ä¸åº”ç”¨çº¿ç¨‹ä¸€èµ·è¿è¡Œï¼Œè¿™ä¸ªæ—¶é—´æ²¡ä»€ä¹ˆæ„ä¹‰ã€‚

#### Full GC

```java
2019-07-15T20:39:19.780+0800: 21227.233: [Full GC (Heap Inspection Initiated GC) 2019-07-15T20:39:19.780+0800: 21227.233: [CMS: 50374K->50344K(1536000K), 0.2175503 secs] 59556K->50344K(1962688K), [Metaspace: 82392K->82392K(1126400K)], 0.2181439 secs] [Times: user=0.22 sys=0.00, real=0.22 secs] 
```

* Full GC - æ”¶é›†æ•´ä¸ªå †ï¼ŒåŒ…æ‹¬young genã€old genã€perm genï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ç­‰æ‰€æœ‰éƒ¨åˆ†ã€‚
   * Full GC (Heap Inspection Initiated GC) - GCè§¦å‘çš„åŸå› ï¼Œè¿™é‡Œæˆ‘æ˜¯æ‰‹åŠ¨è§¦å‘çš„``jmap -histo:live pid``ï¼Œé™¤äº†è¿™ä¸ªå’Œä¹‹å‰çš„Allocation Failureï¼Œä¸€èˆ¬è¿˜ä¼šæœ‰Ergonomicsï¼ˆè¡¨ç¤ºJVMå†…éƒ¨ç¯å¢ƒè®¤ä¸ºæ­¤æ—¶å¯ä»¥è¿›è¡Œä¸€æ¬¡åƒåœ¾æ”¶é›†ï¼‰ã€‚
   * [CMS: 50374K->50344K(1536000K), 0.2175503 secs] - è€å¹´ä»£å½“å‰å ç”¨çš„å†…å­˜->å›æ”¶åå ç”¨çš„å†…å­˜ï¼ˆè€å¹´ä»£æ€»å†…å­˜ï¼‰è¯¥æ“ä½œæŒç»­çš„æ—¶é—´ã€‚
   * 59556K->50344K(1962688K) - å †å½“å‰å ç”¨çš„å†…å­˜->å †å›æ”¶åå ç”¨çš„å†…å­˜ï¼ˆå †çš„æ€»å†…å­˜ï¼‰ è¯¥æ“ä½œæŒç»­çš„æ—¶é—´ã€‚
   * [Metaspace: 82392K->82392K(1126400K)], 0.2181439 secs] - Metaspaceå½“å‰å ç”¨çš„å†…å­˜->Metaspaceå›æ”¶åå ç”¨çš„å†…å­˜ï¼ˆMetaspaceæ€»å†…å­˜ï¼ŸMaxMetaspaceSizeæˆ‘æ˜æ˜è®¾ç½®çš„æ˜¯256Mï¼Œè¿™æ¥è¿‘æœ‰1100Mäº†ï¼Œæœ‰ç‚¹å¥‡æ€ªï¼Œæˆ‘æŸ¥çœ‹äº†``jmap -heap pid``å‚æ•°è®¾ç½®æ˜¯æœ‰æ•ˆçš„ï¼‰ è¯¥æ“ä½œæŒç»­çš„æ—¶é—´ã€‚
   * [Times: user=0.22 sys=0.00, real=0.22 secs] - äº‹ä»¶çš„æŒç»­æ—¶é—´, é€šè¿‡ä¸‰ä¸ªéƒ¨åˆ†æ¥è¡¡é‡ã€‚

### jvmå‚æ•°

> æœ‰äº†ä¸Šé¢æŸ¥çœ‹æ—¥å¿—çš„åŸºç¡€ä¹‹åï¼Œå†ç»“åˆ**jstatã€jmap**ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è¿™äº›æ•°æ®åœ¨jvmå‚æ•°ä¸Šè¿›è¡Œè°ƒä¼˜äº†ï¼ˆè¿™2ä¸ªå·¥å…·å°±ä¸å…·ä½“ä»‹ç»äº†ï¼Œä¸ç„¶ç¯‡å¹…å®åœ¨å¤ªé•¿äº† - -ï¼ï¼‰ã€‚

#### ç»éªŒåˆ†äº«

ä¸‹é¢ç»“åˆå…·ä½“çš„å‚æ•°ï¼Œè¿›è¡Œä¸€äº›ç»éªŒåˆ†äº«ã€‚è¿™æ˜¯æˆ‘ä»¬çº¿ä¸Šå…¶ä¸­ä¸€ä¸ªæœåŠ¡çš„jvmå‚æ•°ï¼š
```java
-Xms2000M -Xmx2000M -XX:MetaspaceSize=256M -XX:MaxMetaspaceSize=256M -Xmn500M -XX:SurvivorRatio=4 -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:ParallelGCThreads=8 -XX:+UseCMSCompactAtFullCollection -XX:CMSFullGCsBeforeCompaction=0 -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70 -XX:+CMSScavengeBeforeRemark -XX:+CMSParallelInitialMarkEnabled -XX:+CMSParallelRemarkEnabled -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintHeapAtGC -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -Xloggc:/data/logs/login/gc/gc.log -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/data/logs/login/gc
```

* ``-Xms2000M -Xmx2000M`` - åˆå§‹å †å¤§å°å’Œæœ€å¤§å †å¤§å°ã€‚å°†Xmså’ŒXmxè®¾ä¸ºä¸€æ ·çš„å€¼ï¼Œå¯ä»¥é¿å…jvmåœ¨å†…å­˜ä¸å¤Ÿæ—¶ï¼Œæ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚
* ``-XX:MetaspaceSize=256M -XX:MaxMetaspaceSize=256M`` - jdk>=8ç§»é™¤äº†Permï¼Œå¼•å…¥äº†Metapsaceï¼Œè¿™ä¸ªå‚æ•°è·Ÿ-Xms -Xmxä¸€æ ·å»ºè®®è®¾ç½®æˆä¸€æ ·ï¼Œå¯ä»¥é¿å…Metapsaceåœ¨å†…å­˜ä¸å¤Ÿæ—¶ï¼Œæ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚å…·ä½“è®¾ç½®å¤šå¤§ï¼Œå»ºè®®ç¨³å®šè¿è¡Œä¸€æ®µæ—¶é—´åé€šè¿‡``jstat -gc pid``ç¡®è®¤ä¸”è¿™ä¸ªå€¼å¤§ä¸€äº›ï¼Œå¯¹äºå¤§éƒ¨åˆ†é¡¹ç›®256Må³å¯ã€‚
* ``-Xmn500M `` - æ–°ç”Ÿä»£å¤§å°
   * å¦‚ä½•é€‰æ‹©å„åˆ†åŒºå¤§å°åº”è¯¥ä¾èµ–åº”ç”¨ç¨‹åºä¸­å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„åˆ†å¸ƒæƒ…å†µï¼šå¦‚æœåº”ç”¨å­˜åœ¨å¤§é‡çš„çŸ­æœŸå¯¹è±¡ï¼Œåº”è¯¥é€‰æ‹©è¾ƒå¤§çš„å¹´è½»ä»£ï¼›å¦‚æœå­˜åœ¨ç›¸å¯¹è¾ƒå¤šçš„æŒä¹…å¯¹è±¡ï¼Œè€å¹´ä»£åº”è¯¥é€‚å½“å¢å¤§ã€‚
* ``-XX:+UseCMSCompactAtFullCollection -XX:CMSFullGCsBeforeCompaction=0`` - å› ä¸ºè€å¹´ä»£ä½¿ç”¨çš„ç®—æ³•æ˜¯mark-copyï¼Œä¸ä¼šå¯¹ç¢ç‰‡è¿›è¡Œå¤„ç†ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå‚æ•°ï¼Œå¯ä»¥å¯¹ç¢ç‰‡è¿›è¡Œå‹ç¼©ï¼Œè§£å†³ç¢ç‰‡çš„é—®é¢˜ã€‚
   * ``-XX:+UseCMSCompactAtFullCollection`` - ä½¿ç”¨å¹¶å‘æ”¶é›†å™¨æ—¶,å¼€å¯å¯¹è€å¹´ä»£çš„å‹ç¼©ã€‚  
   * ``-XX:CMSFullGCsBeforeCompaction=0`` - ä¸Šé¢é…ç½®å¼€å¯çš„æƒ…å†µä¸‹,è¿™é‡Œè®¾ç½®å¤šå°‘æ¬¡Full GCå,å¯¹è€å¹´ä»£è¿›è¡Œå‹ç¼©ã€‚é»˜è®¤æ˜¯0ï¼Œå°±æ˜¯æ¯æ¬¡Full GC(æ³¨æ„æ˜¯Full GCè€Œä¸æ˜¯Old GC)éƒ½ä¼šè¿›è¡Œå†…å­˜å‹ç¼©ã€‚
* ``-XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=70`` - ä¸¤è€…é…åˆä½¿ç”¨ï¼Œåœ¨è€å¹´ä»£ä½¿ç”¨ç‡è¾¾åˆ°70%å°±ä¼šè§¦å‘Old GCã€‚ä¸»è¦æ˜¯ä¸ºäº†é¿å…**[promotion failed](#promotion failed/ç©ºé—´åˆ†é…æ‹…ä¿)ï¼ˆé™„å½•ä¸­ä¼šæœ‰è¯¦è§£ï¼‰**ã€‚
   * ``-XX:CMSInitiatingOccupancyFraction=70`` - è¿™ä¸ªé˜€å€¼éœ€è¦è¿›è¡Œè®¡ç®—ï¼Œé‡‡ç”¨çš„å…¬å¼ä¸º``(Xmx-Xmn)*(1-CMSInitiatingOccupancyFraction/100)>=(Xmn-Xmn/(SurvivorRatior+2))``ï¼ŒæŒ‰ç€è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬çš„å‚æ•°ç®—å‡ºæ¥ä¼šæ˜¯72.2%ï¼Œæ‰€ä»¥è®¾ç½®ä¸º70ã€‚
* ``-XX:+CMSScavengeBeforeRemark`` - å¼€å¯æˆ–å…³é—­åœ¨CMSé‡æ–°æ ‡è®°é˜¶æ®µä¹‹å‰çš„æ¸…é™¤ygcå°è¯•ï¼Œç›®çš„åœ¨äºå‡å°‘old genå¯¹ygc gençš„å¼•ç”¨ã€‚
   * ä¸ºä»€ä¹ˆremarkä¼šè€—æ—¶è¾ƒå¤§ï¼Œä¸»è¦å› ä¸ºæœ‰[è·¨ä»£å¼•ç”¨](#è·¨ä»£å¼•ç”¨)ï¼Œé€ æˆè€—æ—¶è¾ƒå¤§ã€‚
   * ä½¿ç”¨è¿™ä¸ªå‚æ•°ä¼šæ˜¯ä¸€ä¸ªå–èˆï¼Œä¸»è¦çœ‹æ€§èƒ½ç“¶é¢ˆæ˜¯å¦åœ¨remarkä¸Šï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œè¯¥å‚æ•°èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£è¿™ä¸ªé—®é¢˜ï¼ˆå› ä¸ºè¿™ä¸ªå‚æ•°å¹¶ä¸æ˜¯ä¸€å®šä¼šæ‰§è¡Œï¼‰ï¼Œå¦‚æœæ€§èƒ½ç“¶é¢ˆä¸æ˜¯remarkï¼Œé‚£å°±ä¸éœ€è¦å¼€å¯äº†ï¼Œæ¯•ç«Ÿä¼šå¤šä¸€æ¬¡ygcã€‚
   * ä¸€èˆ¬ä½å»¶æ—¶çš„æœåŠ¡ï¼Œå¦‚æœremarkæ—¶é—´>1sæ˜¯æ— æ³•å¿å—çš„ï¼Œæˆ–è€…è¦æ±‚æ›´é«˜ã€‚å› ä¸ºè¯¥é˜¶æ®µä¼šé€ æˆSTWçš„ï¼Œæš‚åœæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼Œé‡æ–°æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œè¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ ‡è®°æ´»ç€çš„å¯¹è±¡ï¼Œæ‰€ä»¥ä½å»¶æ—¶çš„æœåŠ¡å¯ä»¥è€ƒè™‘åŠ ä¸Šã€‚
* gcæ—¥å¿—ç›¸å…³çš„å‚æ•°å»ºè®®é…ç½®ä¸Šï¼Œä¸ç„¶æ’æŸ¥èµ·æ¥å°±æ˜¯æ— å¤´è‹è‡äº†ã€‚

#### å–„ç”¨jmap

> ä¸€ä¸ªå¥½çš„æœåŠ¡çŠ¶æ€ï¼Œæˆ‘ä»¬ä¼šè¦æ±‚FullGCé¢‘ç‡å°½å¯èƒ½å®Œå…¨æœç»ï¼Œä½†æ˜¯å®Œå…¨æœç»æ˜¯ä¸€ä¸ªç†æƒ³çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬é€€è€Œæ±‚å…¶æ¬¡ï¼Œå°½é‡é¿å…å®ƒåœ¨ç™½å¤©ï¼Œç”šè‡³ä¸šåŠ¡é«˜å³°æœŸå‡ºç°ã€‚

æˆ‘ä»¬ä¹‹å‰åœ¨è·å–FGCçš„æ—¥å¿—çš„æ—¶å€™å°±æ˜¯ä½¿ç”¨äº†``jmap -histo:live pid``ï¼Œè¯¥å‘½ä»¤ä¼šå¼ºåˆ¶è¿›è¡ŒFGCã€‚é‚£æˆ‘ä»¬åªéœ€è¦æœ‰ä¸€ä¸ªå®šæ—¶ï¼Œæ¯å¤©åœ¨å‡Œæ™¨å‡ ç‚¹ï¼Œä¸šåŠ¡æœ€ä½å³°æœŸçš„æ—¶å€™è¿è¡Œæ”¹å‘½ä»¤ï¼Œç»“åˆ``-XX:+UseCMSCompactAtFullCollection -XX:CMSFullGCsBeforeCompaction=0``ï¼Œä»è€Œä¼˜åŒ–å†…å­˜ç¢ç‰‡å¹¶å‹ç¼©å †ï¼Œé™ä½åœ¨ä¸šåŠ¡é«˜å³°æœŸå‘ç”ŸFGCçš„æ¦‚ç‡ã€‚


### é™„å½•

#### å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥

##### å¯¹è±¡ä¼˜å…ˆåˆ†é…EdenåŒº

> å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£EdenåŒºä¸­åˆ†é…ã€‚å½“Edenç©ºé—´ä¸è¶³ï¼Œåˆ™ä¼šå‘ç”Ÿä¸€æ¬¡``Young GC``ã€‚

##### å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£

> å¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„javaå¯¹è±¡ï¼ˆå…¸å‹çš„å¦‚é•¿å­—ç¬¦ä¸²å’Œæ•°ç»„ï¼‰ï¼Œå½“æ–°ç”Ÿä»£ä¸è¶³ä»¥å­˜æ”¾å¤§å¯¹è±¡ï¼Œå°±ä¼šè·³è¿‡æ–°ç”Ÿä»£ç›´æ¥è€å¹´ä»£ã€‚

##### é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£

> Jvmç»™æ¯ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡å¹´é¾„(Age)è®¡æ•°å™¨ã€‚å¦‚æœå¯¹è±¡åœ¨Edenå‡ºç”Ÿå¹¶ç»è¿‡ç¬¬ä¸€æ¬¡``Young GC``åä»ç„¶å­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢«``Survivor``å®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ°Survivorç©ºé—´ä¸­ï¼Œå¹¶ä¸”å¯¹è±¡å¹´é¾„è®¾ä¸º1ã€‚å¯¹è±¡åœ¨SurvivoråŒºä¸­æ¯ç†¬è¿‡ä¸€æ¬¡``Young GC``ï¼Œå¹´é¾„å°±å¢åŠ 1å²ã€‚å½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤æ˜¯15å²ï¼‰ï¼Œå°†ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ã€‚å¯ä»¥é€šè¿‡``-XX:MaxTenuringThreshold``å‚æ•°è®¾ç½®æ™‹å‡è€å¹´ä»£çš„é˜ˆå€¼

##### åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š

> ä¸ºäº†èƒ½æ›´å¥½åœ°é€‚åº”ä¸åŒç¨‹åºçš„å†…å­˜æƒ…å†µï¼ŒJvmå¹¶ä¸æ€»æ˜¯è¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ°``MaxTenuringThreshold``æ‰èƒ½æ™‹å‡è€å¹´ä»£ã€‚å¦‚æœåœ¨Survivorç©ºé—´ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚

#### promotion failed/ç©ºé—´åˆ†é…æ‹…ä¿

![ç©ºé—´åˆ†é…æ‹…ä¿](https://github.com/7le/7le.github.io/raw/master/image/jvm/space-allocation-guarantee.png)

å›¾ä¸­æåˆ°äº†æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå½“æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶æ”¶é›†ç®—æ³•ï¼Œä½†æ˜¯ä¸ºäº†å†…å­˜åˆ©ç”¨ç‡ï¼Œåªä½¿ç”¨å…¶ä¸­ä¸€ä¸ª``Survivor``ç©ºé—´æ¥ä½œä¸ºè½®æ¢å¤‡ä»½ï¼Œå› æ­¤å½“å‡ºç°å¤§é‡å¯¹è±¡åœ¨``Young GC``åä¾ç„¶å­˜æ´»ï¼ˆæœ€æç«¯å°±æ˜¯å†…å­˜å›æ”¶åæ–°ç”Ÿä»£ä¸­æ‰€æœ‰å¯¹è±¡éƒ½å­˜æ´»ï¼‰ï¼Œå°±éœ€è¦è€å¹´ä»£è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ŒæŠŠ``Survivor``æ— æ³•å®¹çº³çš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚ä½†æ˜¯å¤šå°‘ä¼šæ™‹å‡åˆ°è€å¹´ä»£åœ¨å®é™…å†…å­˜å›æ”¶å‰æ˜¯æ— æ³•æ˜ç¡®çŸ¥é“çš„ï¼Œæ‰€ä»¥åªå¥½å–ä¹‹å‰æ¯ä¸€æ¬¡å›æ”¶æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡å®¹é‡çš„å¹³å‡å€¼ä½œä¸ºç»éªŒå€¼ï¼Œä¸è€å¹´ä»£å‰©ä½™ç©ºé—´æ¯”è¾ƒï¼Œå†³å®šæ˜¯å¦è¿›è¡Œ``Full GC``æ¥è®©è€å¹´ä»£è…¾å‡ºæ›´å¤šç©ºé—´ã€‚

#### è·¨ä»£å¼•ç”¨

> æ–°ç”Ÿä»£å¯¹è±¡æŒæœ‰è€å¹´ä»£ä¸­å¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™ç§æƒ…å†µç§°ä¸º**è·¨ä»£å¼•ç”¨**

![è·¨ä»£å¼•ç”¨](https://github.com/7le/7le.github.io/raw/master/image/jvm/cross-reference.png)

ä¸Šå›¾ä¸­ï¼Œå¯¹è±¡Aå› ä¸ºå¼•ç”¨å­˜åœ¨æ–°ç”Ÿä»£ä¸­ï¼ŒRemarké˜¶æ®µå¿…é¡»æ‰«ææ•´ä¸ªå †æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼ŒåŒ…æ‹¬å›¾ä¸­ç°è‰²çš„ä¸å¯è¾¾å¯¹è±¡ã€‚

ç°è‰²å¯¹è±¡å·²ç»ä¸å¯è¾¾ï¼Œä½†ä»ç„¶éœ€è¦æ‰«æçš„åŸå› ï¼šæ–°ç”Ÿä»£GCå’Œè€å¹´ä»£çš„GCæ˜¯å„è‡ªåˆ†å¼€ç‹¬ç«‹è¿›è¡Œçš„ï¼Œåªæœ‰YGCæ—¶æ‰ä¼šä½¿ç”¨æ ¹æœç´¢ç®—æ³•ï¼Œæ ‡è®°æ–°ç”Ÿä»£å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œä¹Ÿå°±æ˜¯è¯´è™½ç„¶ä¸€äº›å¯¹è±¡å·²ç»ä¸å¯è¾¾ï¼Œä½†åœ¨YGCå‘ç”Ÿå‰ä¸ä¼šè¢«æ ‡è®°ä¸ºä¸å¯è¾¾ï¼ŒCMSä¹Ÿæ— æ³•è¾¨è®¤å“ªäº›å¯¹è±¡å­˜æ´»ï¼Œåªèƒ½å…¨å †æ‰«æï¼ˆæ–°ç”Ÿä»£+è€å¹´ä»£ï¼‰ã€‚ç”±æ­¤å¯è§å †ä¸­å¯¹è±¡çš„æ•°ç›®å½±å“äº†Remarké˜¶æ®µè€—æ—¶ã€‚ 

å¦å¤–è€ƒè™‘åˆ°è¿™ä¸ªæ‰«æï¼ˆå°±æ˜¯ä¸Šè¿°æ—¥å¿—ä¸­çš„CMS-concurrent-precleanï¼‰å¯èƒ½ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œjvmæä¾›äº†``CMSMaxAbortablePrecleanTime ï¼Œé»˜è®¤ä¸º5s``ï¼Œç›¸å½“äºè¯¥å¯ä¸­æ–­çš„é¢„æ¸…ç†æ‰§è¡Œè¶…è¿‡5sï¼Œä¸ç®¡æ˜¯å¦å‘ç”ŸYGCï¼Œéƒ½ä¼šä¸­æ­¢æ­¤é˜¶æ®µï¼Œè¿›å…¥Remarkã€‚ 

è€Œ``-XX:+CMSScavengeBeforeRemark``å¯ä»¥ä¿è¯Remarkå‰å¼ºåˆ¶è¿›è¡Œä¸€æ¬¡YGCæ¥å›æ”¶ä¸å¯è¾¾å¯¹è±¡ï¼Œå‡å°‘remarkçš„æš‚åœæ—¶é—´ã€‚

#### åŠ¨æ€å¹´é¾„

> Hotspotéå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº†survivoråŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’ŒMaxTenuringThresholdä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼ã€‚

---
[Github](https://github.com/7le) ä¸è¦åå•¬ä½ çš„star ^.^
[æ›´å¤šç²¾å½© æˆ³æˆ‘](https://7le.top)
