---
title: å‰ç«¯è¸©å‘è®°å½•
date: 2017-05-18 00:05:36
type: "tags"
tags: [å‰ç«¯]
---

> å­¦ä¹ çš„é“è·¯å°±æ˜¯ä¸åœçš„è¸©å‘... ğŸ¥•

<!--more-->
#### Longç±»å‹è½¬jsonç²¾åº¦ä¸¢å¤±

ä»Šå¤©åœ¨å¼€å‘çš„æ—¶å€™ï¼Œç”¨swaggeråšæµ‹è¯•ï¼Œè«åçš„å‘ç°è¿”å›çš„Longç±»å‹çš„idè·Ÿæ•°æ®åº“çš„å¯¹åº”ä¸ä¸Šã€‚å»æœäº†ä¸€ä¸‹æ‰å‘ç°ï¼Œjså†…ç½®æœ‰32ä½æ•´æ•°ï¼Œè€Œnumberç±»å‹çš„å®‰å…¨æ•´æ•°æ˜¯53ä½ã€‚å¦‚æœè¶…è¿‡53ä½çš„ï¼Œå°±ä¼šä¸¢å¤±ç²¾åº¦,è€ŒLongç±»å‹æ°æ°æ˜¯64ä½ã€‚

è§£å†³æ–¹å¼å¯ä»¥æ·»åŠ 2ä¸ªç±»ï¼Œ
```
/**
 * Long ç±»å‹å­—æ®µåºåˆ—åŒ–æ—¶è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œé¿å…jsä¸¢å¤±ç²¾åº¦
 */
public class LongJsonSerializer extends JsonSerializer<Long> {
    @Override
    public void serialize(Long value, JsonGenerator jsonGenerator, SerializerProvider serializerProvider) throws IOException, JsonProcessingException {
        String text = (value == null ? null : String.valueOf(value));
        if (text != null) {
            jsonGenerator.writeString(text);
        }
    }
}

/**
 * å°†å­—ç¬¦ä¸²è½¬ä¸ºLong
 *
 */
public class LongJsonDeserializer extends JsonDeserializer<Long> {
    private static final Logger logger = LoggerFactory.getLogger(LongJsonDeserializer.class);
  
    @Override
    public Long deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException, JsonProcessingException {
        String value = jsonParser.getText();
        try {
            return value == null ? null : Long.parseLong(value);
        } catch (NumberFormatException e) {
            logger.error("è§£æé•¿æ•´å½¢é”™è¯¯", e);
            return null;
        }
    }
}
```

ç„¶ååœ¨éœ€è¦å¤„ç†çš„Longç±»å‹çš„idå­—æ®µä¸Šï¼ŒåŠ ä¸Šæ³¨è§£

```
@JsonSerialize(using = LongJsonSerializer.class)
@JsonDeserialize(using = LongJsonDeserializer.class)
private Long id;
```

#### formè¡¨å•ç‚¹å‡»buttonï¼Œajaxæäº¤è‡ªåŠ¨åˆ·æ–°

è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç 
```
<form>
    //çœç•¥ä¸€å †ä»£ç 
    <div class="hr-line-dashed"></div>
        <div class="form-group">
            <div class="col-sm-4 col-sm-offset-2">
            <button class="btn btn-primary"  onclick="submitAcc()">ä¿å­˜å†…å®¹</button>
            <button class="btn btn-white">å–æ¶ˆ</button>
        </div>
    </div>
</form>

<script>
function submitAcc() {
        $.ajax({
            type: "POST",
            url: "/backend/account",
            data: $('#accAdd').serialize(),
            success: function (result) {
                if(result.success==true){
                    swal({title: "ä½ çš„å°è´¦æœ¬~", text: result.msg, type: "success"}, function(){
                        //è·³è½¬è‡³åˆ—è¡¨ç•Œé¢
                        location.href = "/backend/account/list";
                    });
                }else {
                    swal({title: "ä½ çš„å°è´¦æœ¬~", text: result.msg, type: "error"}, function(){
                        //åˆ·æ–°
                        location.reload();
                    });
                }
            },
            error: function (result) {
                swal({title: "ä½ çš„å°è´¦æœ¬~", text: result.msg, type: "error"}, function(){
                    //åˆ·æ–°
                    location.reload();
                });
            }
        });
    }
</script>
```

æœ¬æ¥å°±æ˜¯æƒ³ä¸€ä¸ªæ·»åŠ æ•°æ®çš„åŠŸèƒ½ï¼Œæ¯æ¬¡ç‚¹å‡»æäº¤åç¡¬æ˜¯ç»™æˆ‘åˆ·æ–°é¡µé¢ï¼Œæçš„å¤´æ™•è„‘èƒ€ã€‚åæ¥å„ç§å°è¯•ï¼Œ
å‘ç°formä¸­å­˜åœ¨buttonæ ‡ç­¾æ—¶ï¼Œç”¨ajaxå¼‚æ­¥æäº¤è¡¨å•å°±ä¼šåˆ·æ–°ã€‚

åŸå› ï¼šbutton å­˜åœ¨æ—¶ä¼šå†æ¬¡æäº¤ä¸€ä¸‹è¡¨å•ï¼Œæ‰€ä»¥é¡µé¢è¢«åˆ·æ–°äº†ã€‚ï¼ˆä¹‹å‰è®¤ä¸ºbutton type='submit' æ—¶ï¼‰buttonæ‰æœ‰æäº¤è¡¨å•çš„åŠŸèƒ½ã€‚

è§£å†³ï¼šbuttonæ ‡ç­¾æ¢æˆaæ ‡ç­¾å°±å¯ä»¥äº†ï¼Œæˆ–è€…ä¸ä½¿ç”¨formã€‚

å½“æ—¶çŠ¯å‚»çš„åœ°æ–¹   [å·²ä¿®æ­£åçš„é¡µé¢](https://github.com/7le/shine/blob/1.0-dev/web/WEB-INF/views/backend/account/accountAdd.ftl) ^.^

#### ajaxä½¿ç”¨FormDataå¯¹è±¡ä¸Šä¼ æ–‡ä»¶

é¦–å…ˆç»™å¤§å®¶æ¨èä¸€ä¸ª[å›¾åºŠ](https://sm.ms/)ã€‚

åœ¨å¯¹æ¥æ¥å£çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨FormDataä¸Šä¼ ï¼Œäºæ˜¯å°±æƒ³åŠæ³•è§£å†³äº†ä¸‹ã€‚

ä¸‹é¢æ˜¯å…³é”®çš„ä»£ç 
```
<form id="uploadForm" enctype="multiple/form-data" >
    <input id="smfile" name="smfile" type="file" multiple >
    <input type="button" onclick="send()" value="send">
</form>
```

```
<script type="text/javascript">
function send() {
 
 var formData = new FormData($('#uploadForm')[0]);

 //console.log($('#uploadForm')[0]);
 
 formData.append('format','json');

 $.ajax({
        type:'post',
        url: "https://sm.ms/api/upload",
        data: formData,
        processData: false,
        contentType: false,
        success: function (data) {
            console.log(data);
        }
    });
}
</script>
```
æœ€åè¡¥å……å‡ ç‚¹

* 1ã€inputä¸­å£°æ˜çš„æ˜¯ä»€ä¹ˆï¼Œæ¥æ”¶çš„æ—¶å€™å°±ç”¨ä»€ä¹ˆã€‚ä¾‹å¦‚ä¸Šé¢çš„å°±æ˜¯smfile
* 2ã€processDataè®¾ç½®ä¸ºfalseã€‚å› ä¸ºdataå€¼æ˜¯FormDataå¯¹è±¡ï¼Œä¸éœ€è¦å¯¹æ•°æ®åšå¤„ç†ã€‚
* 3ã€formæ ‡ç­¾æ·»åŠ enctype="multipart/form-data"å±æ€§ã€‚
* 4ã€cacheè®¾ç½®ä¸ºfalseï¼Œä¸Šä¼ æ–‡ä»¶ä¸éœ€è¦ç¼“å­˜ã€‚contentTypeè®¾ç½®ä¸ºfalseã€‚å› ä¸ºæ˜¯ç”±formè¡¨å•æ„é€ çš„FormDataå¯¹è±¡ï¼Œä¸”å·²ç»å£°æ˜äº†å±æ€§enctype="multipart/form-data"ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºfalseã€‚

---
[Github](https://github.com/7le) ä¸è¦åå•¬ä½ çš„star ^.^
[æ›´å¤šç²¾å½© æˆ³æˆ‘](https://7le.top)