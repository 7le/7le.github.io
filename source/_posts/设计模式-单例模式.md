---
title: è®¾è®¡æ¨¡å¼--å•ä¾‹æ¨¡å¼
date: 2017-05-14 20:18:45
type: "tags"
tags: [è®¾è®¡æ¨¡å¼]
---

> æœ¬ä»¥ä¸ºå•ä¾‹æ¨¡å¼å°±æ˜¯ç®€å•çš„æ¨¡å¼ï¼Œéå¸¸æ¸…æ™°æ˜äº†ï¼Œä»Šå¤©è·Ÿè€è¢ä¸€èŠå¤©ï¼Œè®©æˆ‘æ›´å¤šçš„äº†è§£äº†å®ƒçš„ç²¾å¦™ä¹‹å¤„ï¼Œä»¥åŠè¦å†™å‡ºç²¾å¦™çš„å•ä¾‹æ¨¡å¼ä¹Ÿæ˜¯å¾ˆæœ‰è®²ç©¶ã€‚ ğŸ¥•

<!--more-->

æƒ³å¿…å¤§å®¶éƒ½çŸ¥é“ï¼Œå•ä¾‹æ¨¡å¼ä¸ºä»€ä¹ˆç§°ä¹‹ä¸ºå•ä¾‹æ¨¡å¼ã€‚å› ä¸ºè¿™ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¼šè‡ªè¡Œå®ä¾‹åŒ–ï¼Œå¹¶æä¾›è¯¥å®ä¾‹ã€‚æ€»ç»“ä¸€ä¸‹å°±æ˜¯å•ä¾‹æ¨¡å¼å°†ä¼šæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
* 1ã€å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚
* 2ã€å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚
* 3ã€å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹ã€‚

### é¥¿æ±‰å¼å•ä¾‹  
>å•ä¾‹æ¨¡å¼å¿…æçš„ï¼Œé¥¿æ±‰æ‡’æ±‰ï¼Œä¸¤å¤§å£®æ±‰~
  
  ```
//é¥¿æ±‰å¼å•ä¾‹ç±».åœ¨ç±»åˆå§‹åŒ–æ—¶ï¼Œå·²ç»è‡ªè¡Œå®ä¾‹åŒ–   
public class Singleton {  
    private Singleton() {}  
    private static final Singleton single = new Singleton();  
    //é™æ€å·¥å‚æ–¹æ³•   
    public static Singleton getInstance() {  
       return single;  
    }  
}  
  ```
è¿™ä¸ªç±»,ä¸€å¼€å§‹å°±ç”Ÿæˆäº†ä¸€ä¸ªé™æ€çš„å¯¹è±¡ä¾›ç³»ç»Ÿä½¿ç”¨ï¼Œå°±åƒä¸€ä¸ªé¥¿çš„ä¸è¡Œçš„å£®æ±‰å†²è¿›é¥­é¦†ï¼ˆç³»ç»ŸåŠ è½½ï¼‰å°±è¿«ä¸åŠå¾…çš„å¼€åƒäº†ï¼ˆå®ä¾‹åŒ–å¯¹è±¡ï¼‰ï¼Œè¿™ä¸ªç±»ä»¥åä¹Ÿä¸ä¼šæ”¹å˜ï¼Œæ˜¯å¤©ç”Ÿçº¿ç¨‹å®‰å…¨çš„ã€‚

### æ‡’æ±‰å¼å•ä¾‹ 
>ç¬¬äºŒä¸ªå£®æ±‰æ¥äº†ï¼Œä¸è¿‡ä»–æ˜¯ä¸ªæ‡’æ±‰ï¼Œæ‡’æ´‹æ´‹çš„~

```
public class Singleton1 {

    private Singleton1(){}
    //è¿™é‡Œå°±ä¸å†å®šä¹‰final
    private static Singleton1 single1 =null;

    public static Singleton1 getInstance(){
        if(single1==null){
            single1 = new Singleton1();
        }
        return single1;
    }

}
```
è¿™ä¸ªå£®æ±‰æ¯”è¾ƒæ‡’ï¼Œä»–æ…¢è…¾è…¾çš„åœ¨é¥­é¦†åä¸‹äº†ï¼Œç­‰ç€æœ‹å‹æ¥å–Šä»–ä¸€èµ·åƒï¼ˆåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™å®ä¾‹åŒ–è‡ªå·±ï¼‰ã€‚  
åˆ°è¿™é‡Œæˆ‘ä»¬ä¸€èˆ¬éƒ½è§‰å¾—æŠŠå•ä¾‹æ¨¡å¼çœ‹çš„ä¸ƒä¸ƒå…«å…«äº†ï¼Œæˆ–è®¸æœ‰å‰å®³çš„å…„å¼Ÿè§‰å¾—è¿˜ç¼ºç‚¹ä»€ä¹ˆï¼Œæ˜¯çš„ã€‚é¥¿æ±‰ä¸æ¯”æ‡’æ±‰ï¼Œä»–æ˜¯ä¸å®‰å…¨çš„ã€‚ä»¥å‰æˆ‘ä¹Ÿæ˜¯åªçŸ¥é“ä¸ªä¸å®‰å…¨ï¼ŒçŸ¥é“è¦åŠ ä¸ªåŒæ­¥é”ã€‚ä»Šå¤©ç»è¿‡è€è¢çš„ä¸€è®²è§£ï¼Œè±ç„¶å¼€æœ—ã€‚

### åŠ ä¸ŠåŒæ­¥é”çš„ æ‡’æ±‰æ¨¡å¼
```
public class Singleton2 {

    private Singleton2(){}

    private static Singleton2 single2 =null;

    public synchronized static Singleton2 getInstance(){
        if(single2==null){
            single2 = new Singleton2();
        }
        return single2;
    }

}
```
åŠ ä¸Šsynchronizedï¼Œæˆ‘ä»¬ç¡®ä¿äº†åŒæ­¥ã€‚ä½†æ˜¯è¦åŒæ­¥ï¼Œå°±ç‰ºç‰²äº†æ€§èƒ½ï¼Œæ›´ä½•å†µæˆ‘ä»¬åœ¨ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯ä¸éœ€è¦åŒæ­¥çš„ã€‚äºæ˜¯ä¹ï¼Œæˆ‘ä»¬æœ‰äº†ä»¥ä¸‹çš„æ–¹æ¡ˆã€‚

### åŒé‡æ£€æŸ¥é”å®šçš„ æ‡’æ±‰æ¨¡å¼
```
public class Singleton3 {

    private Singleton3(){}

    private static Singleton3 single3 =null;
    
    public static Singleton3 getInstance(){
        if(single3==null){                       
            synchronized (Singleton3.class){     //1
                if (single3 == null){            //2
                    single3 = new Singleton3();  //3
                }
            }
        }
        return single3;
    }

}
```

åŒé‡æ£€æŸ¥é”å®šï¼Œåœ¨ //2 å¤„çš„ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼Œåˆ›å»ºä¸¤ä¸ªä¸åŒçš„ Singleton å¯¹è±¡æˆä¸ºä¸å¯èƒ½ã€‚
å‡è®¾æœ‰ä¸‹åˆ—äº‹ä»¶åºåˆ—ï¼š

1. çº¿ç¨‹ 1 è¿›å…¥ getInstance() æ–¹æ³•ã€‚
2. ç”±äº instance ä¸º null ï¼Œçº¿ç¨‹ 1 åœ¨ //1 å¤„è¿›å…¥ synchronized å—ã€‚
3. çº¿ç¨‹ 1 è¢«çº¿ç¨‹ 2 é¢„å ã€‚
4. çº¿ç¨‹ 2 è¿›å…¥ getInstance() æ–¹æ³•ã€‚
5. ç”±äº instance ä»æ—§ä¸º null ï¼Œçº¿ç¨‹ 2 è¯•å›¾è·å– //1 å¤„çš„é”ã€‚ç„¶è€Œï¼Œç”±äºçº¿ç¨‹ 1 æŒæœ‰è¯¥é”ï¼Œçº¿ç¨‹ 2 åœ¨ //1 å¤„é˜»å¡ã€‚
6. çº¿ç¨‹ 2 è¢«çº¿ç¨‹ 1 é¢„å ã€‚
7. çº¿ç¨‹ 1 æ‰§è¡Œï¼Œç”±äºåœ¨ //2 å¤„å®ä¾‹ä»æ—§ä¸º null ï¼Œçº¿ç¨‹ 1 è¿˜åˆ›å»ºä¸€ä¸ª Singleton å¯¹è±¡å¹¶å°†å…¶å¼•ç”¨èµ‹å€¼ç»™ instance 
8. çº¿ç¨‹ 1 é€€å‡º synchronized å—å¹¶ä» getInstance() æ–¹æ³•è¿”å›å®ä¾‹ã€‚
9. çº¿ç¨‹ 1 è¢«çº¿ç¨‹ 2 é¢„å ã€‚
10. çº¿ç¨‹ 2 è·å– //1 å¤„çš„é”å¹¶æ£€æŸ¥ instance æ˜¯å¦ä¸º nullã€‚
11. ç”±äºinstanceæ˜¯énullçš„ï¼Œå¹¶æ²¡æœ‰åˆ›å»ºç¬¬äºŒä¸ªSingletonå¯¹è±¡ï¼Œç”±çº¿ç¨‹1åˆ›å»ºçš„å¯¹è±¡è¢«è¿”å›ã€‚

åŒé‡æ£€æŸ¥é”å®šèƒŒåçš„ç†è®ºæ˜¯å®Œç¾çš„ã€‚ä¸å¹¸åœ°æ˜¯ï¼Œç°å®å®Œå…¨ä¸åŒã€‚åŒé‡æ£€æŸ¥é”å®šçš„é—®é¢˜æ˜¯ï¼šå¹¶ä¸èƒ½ä¿è¯å®ƒä¼šåœ¨å•å¤„ç†å™¨æˆ–å¤šå¤„ç†å™¨è®¡ç®—æœºä¸Šé¡ºåˆ©è¿è¡Œã€‚å› ä¸ºJavaå¹³å°å†…å­˜æ¨¡å‹ï¼Œå†…å­˜æ¨¡å‹å…è®¸æ‰€è°“çš„â€œæ— åºå†™å…¥â€ï¼Œè¿™ä¹Ÿæ˜¯è¿™äº›ä¹ è¯­å¤±è´¥çš„ä¸€ä¸ªä¸»è¦åŸå› ã€‚

å½“çº¿ç¨‹2è¿›å…¥getInstance() æ–¹æ³•ï¼Œå¯èƒ½ä¼šç›´æ¥å¾—åˆ°ä¸€ä¸ªå°šæœªæ‰§è¡Œæ„é€ å‡½æ•°çš„å¯¹è±¡ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥volatileï¼Œæ¥ä¿è¯é¡ºåºã€‚æ‰€ä»¥æœ€åçš„ä»£ç åº”è¯¥æ˜¯
```
public class Singleton4 {

    private Singleton4(){}

    private static volatile Singleton4 single4 =null;

    public static Singleton4 getInstance(){
        if(single4==null){
            synchronized (Singleton4.class){
                if (single4 == null){
                    single4 = new Singleton4();
                }
            }
        }
        return single4;
    }

}
```
ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œä¹‹å‰åŒé‡æ£€æŸ¥é”çš„åŸå› æ˜¯ï¼Œæˆ‘ä»¬çœ‹ä»¥ä¸‹çš„ä¼ªä»£ç 
1. memory=allocate(); //1:åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´
2. ctorInstance(memory); //2:åˆå§‹åŒ–å¯¹è±¡
3. instance=memory; //3:è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€
ä¸Šé¢3è¡Œä»£ç ä¸­çš„2å’Œ3ä¹‹é—´ï¼Œå¯èƒ½ä¼šè¢«é‡æ’åºå¯¼è‡´å…ˆ3å2, è€Œvolatileæ˜¯è¦ä¿è¯å¯è§æ€§ï¼Œå³instanceå®ä¾‹åŒ–åé©¬ä¸Šå¯¹å…¶ä»–çº¿ç¨‹å¯è§ï¼Œå¹¶æ²¡æœ‰èƒ½è§£å†³æ‰è¿™ä¸ªåŒé‡é”çš„é—®é¢˜ã€‚
é‚£æˆ‘ä»¬è¦æ€ä¹ˆåŠå‘¢ï¼Ÿ

### é™æ€åµŒå¥—ç±» æ‡’æ±‰æ¨¡å¼

```
public class Singleton5 {

    private static class LazyHolder {
        private static final Singleton5 INSTANCE = new Singleton5();
    }

    private Singleton5 (){}

    public static final Singleton5 getInstance() {
        return LazyHolder.INSTANCE;
    }
} 
```
ä¹‹å‰çš„é‚£ä¹ˆå¤šæ–¹æ³•ï¼Œéƒ½æ˜¯ä¸ºäº†èƒ½ä¿è¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå»å¾—åˆ°è¿™ä¸ªç¤ºä¾‹ã€‚æˆ‘ä»¬æ¢ä¸ªæ–¹å¼åˆ©ç”¨äº†classloaderçš„æœºåˆ¶æ¥ä¿è¯åˆå§‹åŒ–instanceæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒåŒæ—¶æ²¡æœ‰æ€§èƒ½æŸè€—.
å†™äº†è¿™ä¹ˆå¤šï¼Œä¹ŸæŠŠå•ä¾‹æ¨¡å¼çœŸæ­£çš„æ•´ç†äº†ä¸ƒä¸ƒå…«å…«ï¼Œæœç„¶ç¨‹åºå‘˜è¿˜æ˜¯éœ€è¦å¤šäº¤æµï¼Œå¤šæ€è€ƒ~è¿˜æ˜¯å¾ˆå¸Œæœ›æœ‰è®¸å¤šè€javaï¼Œæ¥æŒ‡å¯¼æŒ‡å¯¼æˆ‘ä»¬è¿™äº›åˆšåˆšæ­¥å…¥javaå¤§é—¨çš„èœé¸Ÿä»¬~

### ç™»è®°å¼å•ä¾‹(æŸ¥æ‰¾èµ„æ–™çš„æ—¶å€™çœ‹åˆ°çš„ï¼Œä¹Ÿä¸€èµ·åˆ†äº«äº†ï¼Œå¯å¿½ç•¥)
```
//ç±»ä¼¼Springé‡Œé¢çš„æ–¹æ³•ï¼Œå°†ç±»åæ³¨å†Œï¼Œä¸‹æ¬¡ä»é‡Œé¢ç›´æ¥è·å–ã€‚
public class Singleton6 {
    private static Map<String,Singleton6> map = new HashMap<String,Singleton6>();
    static{
        Singleton6 singleton6 = new Singleton6();
        map.put(singleton6.getClass().getName(), singleton6);
    }
    //ä¿æŠ¤çš„é»˜è®¤æ„é€ å­
    protected Singleton6(){}
    //é™æ€å·¥å‚æ–¹æ³•,è¿”è¿˜æ­¤ç±»æƒŸä¸€çš„å®ä¾‹
    public static Singleton6 getInstance(String name) {
        if(name == null) {
            name = Singleton6.class.getName();
            System.out.println("name == null"+"--->name="+name);
        }
        if(map.get(name) == null) {
            try {
                map.put(name, (Singleton6) Class.forName(name).newInstance());
            } catch (InstantiationException e) {
                e.printStackTrace();
            } catch (IllegalAccessException e) {
                e.printStackTrace();
            } catch (ClassNotFoundException e) {
                e.printStackTrace();
            }
        }
        return map.get(name);
    }
    //ä¸€ä¸ªç¤ºæ„æ€§çš„å•†ä¸šæ–¹æ³•
    public String about() {
        return "Hello, I am RegSingleton.";
    }
    public static void main(String[] args) {
        Singleton6 singleton6 = Singleton6.getInstance(null);
        System.out.println(singleton6.about());
    }
}
```

æœ€åçš„æœ€åï¼Œå¦‚æœå¤§å®¶ä¹Ÿæ˜¯æ‡’æ±‰ï¼Œå¯¹åº”çš„demoå¯ä»¥ç›´æ¥ç›´æ¥ç‚¹[å•ä¾‹æ¨¡å¼](https://github.com/7le/shine-learning/tree/master/design-patterns/src/main/java/com/design/patterns/singleton) 

---
[Github](https://github.com/7le) ä¸è¦åå•¬ä½ çš„star ^.^
[æ›´å¤šç²¾å½© æˆ³æˆ‘](https://7le.top)